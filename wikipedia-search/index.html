<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<script defer src="../js/alpine.min.js"></script>
	<link rel="stylesheet" href="style.css?20210114">


	<title>WikiP Search</title>
</head>
<body>

<div class="main">
<h3>Conlang examples from Wikipedia</h3> 


<div x-data="alpineInstance()">

	<p>Change language</p>

	<nav>
		<ul>
			<li 
				x-on:click="selected_locale = 'ia'; wikipedia_address_locale = 'https://ia.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch='" 
				x-bind:class="{ 'language-selector-active': selected_locale === 'ia' }">
				Interlingua
			</li>
			<li 
				x-on:click="selected_locale = 'ie'; wikipedia_address_locale = 'https://ie.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch='" 
				x-bind:class="{ 'language-selector-active': selected_locale === 'ie' }">
				Interlingue (Occidental)
			</li>
			<li 
				x-on:click="selected_locale = 'eo'; wikipedia_address_locale = 'https://eo.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch='" 
				x-bind:class="{ 'language-selector-active': selected_locale === 'eo' }">
				Esperanto
			</li>
			<li 
				x-on:click="selected_locale = 'io'; wikipedia_address_locale = 'https://io.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch='" 
				x-bind:class="{ 'language-selector-active': selected_locale === 'io' }">
				Ido
			</li>
			<li 
				x-on:click="selected_locale = 'lfn'; wikipedia_address_locale = 'https://lfn.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch='" 
				x-bind:class="{ 'language-selector-active': selected_locale === 'lfn' }">
				Elefen
			</li>
		</ul>
	</nav>

	<p><a @click="clearLocalStorage" href="#">Clear saved languages</a></p>

	<p>Select Wikipedia Language</p>

	<input 
		type="text" 
		placeholder="Filter languages" 
		x-model="searchLanguages" 
		class="border p-2 rounded mb-4"
		@keyup="updateWikipediaAddressLocale"
	/>
	= 	
	<select x-ref="selected_locale_ref" x-model="selected_locale" x-on:change="wikipedia_address_locale = 'https://' + selected_locale + '.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch='">
		<option selected disabled x-show="searchLanguages === ''">Select a language</option>
		<template x-for="wiki in filteredListOfWikipedias" :key="wiki.code">
			<option :value="wiki.code" x-text="wiki.lang"></option>
		</template>
	</select>
	
	<p>Search for a word "or phrase" and hit return.</p>

	<form x-on:submit.prevent="fetchData">
		<input x-model="search" type="text">
	</form>

	<template x-if="!error">
		<div>
			<p>
				<span>Total hits:</span>
				<span x-text="fetch_result.query.searchinfo.totalhits"></span>
				<span> (max limit 500)</span>
			</p>
			<div x-show="fetch_result.query.searchinfo.totalhits > 0">
				<div>
				<template x-for="(search, index) in fetch_result.query.search" :key="index">
					<div>
						<h4 x-text="search.title"></h4>
						<p x-html="search.snippet"></p>
						<hr>
					</div>
				</template>
				</div>
			</div>
		</div>
	</template>
	<template x-if="error">
		<p>
			<span>Error:</span>
			<span x-text="error"></span>
		</p>
	</template>


</div>

<script>

function alpineInstance() {
	return {
		search: '',
		searchLanguages: '',
		// selected_locale: 'ia',
		// wikipedia_address_locale: 'https://ia.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch=',
		selected_locale: '',
		wikipedia_address_locale: '',
		fetch_result: { query: { searchinfo: { totalhits: 0 } } },
		listOfWikipedias: listOfWikipedias,
		savedLanguages: (JSON.parse(localStorage.getItem('savedLanguages')) || []),
		error: false,
		errors: {
			WIKIP_ERR: "There was an error retrieving the results from WikiPedia.",
			FETCH_ERR: "There was an error retrieving the connecting to the WikiPedia."
		},
		selected_locale_ref: '',

		fetchData: function () { 
			//console.log(this.search);
			return fetch( this.wikipedia_address_locale + this.search + '&srwhat=text&origin=*' )
				.then(response => response.json())
				.then(data => {
					this.error = false;
					if (data.hasOwnProperty('error')) { // Handle wikipedia returned error state
						this.fetch_result.query.searchinfo.totalhits = 0;
						return (this.error = this.errors.WIKIP_ERR);
					}
					return (this.fetch_result = data);
				})
				.catch(error => {
					this.error = this.errors.FETCH_ERR;
					this.fetch_result.query.searchinfo.totalhits = 0;
				});
		},
		get filteredListOfWikipedias() {
			if (!this.searchLanguages) return this.listOfWikipedias;
			return this.listOfWikipedias.filter(wiki =>
				wiki.lang.toLowerCase().includes(this.searchLanguages.toLowerCase())
			);
		},
		updateWikipediaAddressLocale() {
            this.selected_locale = this.$refs.selected_locale_ref.value;
			this.wikipedia_address_locale = 'https://' + this.selected_locale + '.wikipedia.org/w/api.php?action=query&format=json&list=search&srlimit=500&srsearch=';
			this.saveToLocalStorage();
			console.log(JSON.parse(localStorage.getItem('savedLanguages')));
        },
		saveToLocalStorage() {
			// let savedLanguages = JSON.parse(localStorage.getItem('savedLanguages')) || [];
			const newLanguage = {
				selected_locale: this.selected_locale,
				wikipedia_address_locale: this.wikipedia_address_locale
			};
			// Check if selected_locale already exists as a property value in savedLanguages
			const index = this.savedLanguages.findIndex(lang => lang.selected_locale === this.selected_locale);

			if (index === -1) {
				this.savedLanguages.push(newLanguage);
				localStorage.setItem('savedLanguages', JSON.stringify(this.savedLanguages));
			}
		},
		clearLocalStorage() {
			localStorage.removeItem('savedLanguages');
			this.savedLanguages = [];
		}
	}
}

const listOfWikipedias = [
{"lang":"Abkhaz","code":"ab"},
{"lang":"Acehnese","code":"ace"},
{"lang":"Adyghe","code":"ady"},
{"lang":"Afrikaans","code":"af"},
{"lang":"Albanian","code":"sq"},
{"lang":"AlemannicGerman","code":"als"},
{"lang":"Amharic","code":"am"},
{"lang":"Amis","code":"ami"},
{"lang":"Angika","code":"anp"},
{"lang":"Arabic","code":"ar"},
{"lang":"Aragonese","code":"an"},
{"lang":"Aramaic(Syriac)","code":"arc"},
{"lang":"Armenian","code":"hy"},
{"lang":"Aromanian","code":"roa-rup"},
{"lang":"Assamese","code":"as"},
{"lang":"Asturian","code":"ast"},
{"lang":"Atayal","code":"tay"},
{"lang":"Atikamekw","code":"atj"},
{"lang":"Avar","code":"av"},
{"lang":"Awadhi","code":"awa"},
{"lang":"Aymara","code":"ay"},
{"lang":"Azerbaijani","code":"az"},
{"lang":"Balinese","code":"ban"},
{"lang":"Bambara","code":"bm"},
{"lang":"Banjarese","code":"bjn"},
{"lang":"Banyumasan","code":"map-bms"},
{"lang":"Bashkir","code":"ba"},
{"lang":"Basque","code":"eu"},
{"lang":"Bavarian","code":"bar"},
{"lang":"Belarusian(officialNarkamaŭkaorthography)","code":"be"},
{"lang":"Belarusian(Taraškievicaorthography)","code":"be-tarask"},
{"lang":"Bengali","code":"bn"},
{"lang":"Betawi","code":"bew"},
{"lang":"Bihari(Bhojpuri)","code":"bh"},
{"lang":"BishnupriyaManipuri","code":"bpy"},
{"lang":"Bislama","code":"bi"},
{"lang":"Bosnian","code":"bs"},
{"lang":"Breton","code":"br"},
{"lang":"Buginese","code":"bug"},
{"lang":"Bulgarian","code":"bg"},
{"lang":"Burmese","code":"my"},
{"lang":"Buryat(RussiaBuriat)","code":"bxr"},
{"lang":"Cantonese","code":"zh-yue"},
{"lang":"Catalan","code":"ca"},
{"lang":"Cebuano","code":"ceb"},
{"lang":"CentralBikol","code":"bcl"},
{"lang":"CentralTibetan(LhasaTibetan)","code":"bo"},
{"lang":"Chamorro","code":"ch"},
{"lang":"Chechen","code":"ce"},
{"lang":"Cherokee","code":"chr"},
{"lang":"Chewa","code":"ny"},
{"lang":"Cheyenne","code":"chy"},
{"lang":"Chinese(writtenvernacularChinese)","code":"zh"},
{"lang":"Chuvash","code":"cv"},
{"lang":"ClassicalChinese","code":"zh-classical"},
{"lang":"Cornish","code":"kw"},
{"lang":"Corsican","code":"co"},
{"lang":"Cree","code":"cr"},
{"lang":"CrimeanTatar","code":"crh"},
{"lang":"Croatian","code":"hr"},
{"lang":"Czech","code":"cs"},
{"lang":"Dagaare","code":"dga"},
{"lang":"Dagbani","code":"dag"},
{"lang":"Danish","code":"da"},
{"lang":"Dinka","code":"din"},
{"lang":"Doteli","code":"dty"},
{"lang":"Dutch","code":"nl"},
{"lang":"DutchLowSaxon","code":"nds-nl"},
{"lang":"Dzongkha","code":"dz"},
{"lang":"EasternMin","code":"cdo"},
{"lang":"EgyptianArabic","code":"arz"},
{"lang":"Emilian–Romagnol","code":"eml"},
{"lang":"English","code":"en"},
{"lang":"Erzya","code":"myv"},
{"lang":"Esperanto","code":"eo"},
{"lang":"Estonian","code":"et"},
{"lang":"Ewe","code":"ee"},
{"lang":"Extremaduran","code":"ext"},
{"lang":"Fante","code":"fat"},
{"lang":"Farefare(Gurene)","code":"gur"},
{"lang":"Faroese","code":"fo"},
{"lang":"FijiHindi","code":"hif"},
{"lang":"Fijian","code":"fj"},
{"lang":"Finnish","code":"fi"},
{"lang":"Fon","code":"fon"},
{"lang":"Franco-Provençal","code":"frp"},
{"lang":"French","code":"fr"},
{"lang":"FrenchGuianeseCreole","code":"gcr"},
{"lang":"Friulian","code":"fur"},
{"lang":"Fula","code":"ff"},
{"lang":"Gagauz","code":"gag"},
{"lang":"Galician","code":"gl"},
{"lang":"GanChinese","code":"gan"},
{"lang":"Georgian","code":"ka"},
{"lang":"German","code":"de"},
{"lang":"GhanaianPidginEnglish","code":"gpe"},
{"lang":"Gilaki","code":"glk"},
{"lang":"Gorontalo","code":"gor"},
{"lang":"Gothic","code":"got"},
{"lang":"Greek","code":"el"},
{"lang":"Greenlandic","code":"kl"},
{"lang":"Guarani","code":"gn"},
{"lang":"Gujarati","code":"gu"},
{"lang":"Gun","code":"guw"},
{"lang":"HaitianCreole","code":"ht"},
{"lang":"HakkaChinese","code":"hak"},
{"lang":"Hausa","code":"ha"},
{"lang":"Hawaiian","code":"haw"},
{"lang":"Hebrew","code":"he"},
{"lang":"HillMari","code":"mrj"},
{"lang":"Hindi","code":"hi"},
{"lang":"Hungarian","code":"hu"},
{"lang":"Ibanlanguage","code":"iba"},
{"lang":"Icelandic","code":"is"},
{"lang":"Ido","code":"io"},
{"lang":"Igala","code":"igl"},
{"lang":"Igbo","code":"ig"},
{"lang":"Ilocano","code":"ilo"},
{"lang":"InariSámi","code":"smn"},
{"lang":"Indonesian","code":"id"},
{"lang":"Ingush","code":"inh"},
{"lang":"Interlingua","code":"ia"},
{"lang":"Interlingue","code":"ie"},
{"lang":"Inuktitut","code":"iu"},
{"lang":"Iñupiaq","code":"ik"},
{"lang":"Irish","code":"ga"},
{"lang":"Italian","code":"it"},
{"lang":"JamaicanPatois","code":"jam"},
{"lang":"Japanese","code":"ja"},
{"lang":"Javanese","code":"jv"},
{"lang":"Judaeo-Spanish","code":"lad"},
{"lang":"Kabardian","code":"kbd"},
{"lang":"Kabiye","code":"kbp"},
{"lang":"Kabyle","code":"kab"},
{"lang":"Kadazandusun","code":"dtp"},
{"lang":"KalmykOirat","code":"xal"},
{"lang":"Kannada","code":"kn"},
{"lang":"Kapampangan","code":"pam"},
{"lang":"Karachay-Balkar","code":"krc"},
{"lang":"Karakalpak","code":"kaa"},
{"lang":"Kashmiri","code":"ks"},
{"lang":"Kashubian","code":"csb"},
{"lang":"Kazakh","code":"kk"},
{"lang":"Khmer","code":"km"},
{"lang":"Kikuyu","code":"ki"},
{"lang":"Kinyarwanda","code":"rw"},
{"lang":"Kirundi","code":"rn"},
{"lang":"Komi","code":"kv"},
{"lang":"Komi-Permyak","code":"koi"},
{"lang":"Kongo","code":"kg"},
{"lang":"Konkani(GoanKonkani)","code":"gom"},
{"lang":"Korean","code":"ko"},
{"lang":"Kotava","code":"avk"},
{"lang":"Kurdish(Kurmanji)","code":"ku"},
{"lang":"Kurdish(Sorani)","code":"ckb"},
{"lang":"Kusaal","code":"kus"},
{"lang":"Kyrgyz","code":"ky"},
{"lang":"Ladin","code":"lld"},
{"lang":"Lak","code":"lbe"},
{"lang":"Lao","code":"lo"},
{"lang":"Latgalian","code":"ltg"},
{"lang":"Latin","code":"la"},
{"lang":"Latvian","code":"lv"},
{"lang":"Lezgian","code":"lez"},
{"lang":"Ligurian","code":"lij"},
{"lang":"Limburgish","code":"li"},
{"lang":"Lingala","code":"ln"},
{"lang":"LinguaFrancaNova","code":"lfn"},
{"lang":"Lithuanian","code":"lt"},
{"lang":"Livvi-Karelian","code":"olo"},
{"lang":"Lojban","code":"jbo"},
{"lang":"Lombard","code":"lmo"},
{"lang":"LowGerman","code":"nds"},
{"lang":"LowerSorbian","code":"dsb"},
{"lang":"Luganda","code":"lg"},
{"lang":"Luxembourgish","code":"lb"},
{"lang":"Macedonian","code":"mk"},
{"lang":"Madurese","code":"mad"},
{"lang":"Maithili","code":"mai"},
{"lang":"Malagasy","code":"mg"},
{"lang":"Malay","code":"ms"},
{"lang":"Malayalam","code":"ml"},
{"lang":"Maldivian","code":"dv"},
{"lang":"Maltese","code":"mt"},
{"lang":"MandailingBatak","code":"btm"},
{"lang":"Manx","code":"gv"},
{"lang":"Māori","code":"mi"},
{"lang":"Marathi","code":"mr"},
{"lang":"Mazanderani","code":"mzn"},
{"lang":"MeadowMari","code":"mhr"},
{"lang":"Meitei","code":"mni"},
{"lang":"Minangkabau","code":"min"},
{"lang":"Mingrelian","code":"xmf"},
{"lang":"Mirandese","code":"mwl"},
{"lang":"Moksha","code":"mdf"},
{"lang":"Mon","code":"mnw"},
{"lang":"Mongolian","code":"mn"},
{"lang":"MoroccanArabic","code":"ary"},
{"lang":"N'Ko","code":"nqo"},
{"lang":"Nahuatl","code":"nah"},
{"lang":"Navajo","code":"nv"},
{"lang":"Neapolitan","code":"nap"},
{"lang":"Nepali","code":"ne"},
{"lang":"Newar","code":"new"},
{"lang":"Nias","code":"nia"},
{"lang":"NigerianPidgin","code":"pcm"},
{"lang":"Norfuk","code":"pih"},
{"lang":"Norman","code":"nrm"},
{"lang":"NorthFrisian","code":"frr"},
{"lang":"NorthernSámi","code":"se"},
{"lang":"NorthernSotho","code":"nso"},
{"lang":"Norwegian(Bokmål)","code":"no"},
{"lang":"Norwegian(Nynorsk)","code":"nn"},
{"lang":"Novial","code":"nov"},
{"lang":"Obolo","code":"ann"},
{"lang":"Occitan","code":"oc"},
{"lang":"Odia","code":"or"},
{"lang":"OldChurchSlavonic","code":"cu"},
{"lang":"OldEnglish","code":"ang"},
{"lang":"Oromo","code":"om"},
{"lang":"Ossetian","code":"os"},
{"lang":"Pa'O","code":"blk"},
{"lang":"Paiwan","code":"pwn"},
{"lang":"PalatineGerman","code":"pfl"},
{"lang":"Pali","code":"pi"},
{"lang":"Pangasinan","code":"pag"},
{"lang":"Papiamento","code":"pap"},
{"lang":"Pashto","code":"ps"},
{"lang":"PennsylvaniaDutch","code":"pdc"},
{"lang":"Persian","code":"fa"},
{"lang":"Picard","code":"pcd"},
{"lang":"Piedmontese","code":"pms"},
{"lang":"Polish","code":"pl"},
{"lang":"PonticGreek","code":"pnt"},
{"lang":"Portuguese","code":"pt"},
{"lang":"Punjabi","code":"pa"},
{"lang":"Quechua(SouthernQuechua)","code":"qu"},
{"lang":"Ripuarian","code":"ksh"},
{"lang":"Romani(VlaxRomani)","code":"rmy"},
{"lang":"Romanian","code":"ro"},
{"lang":"Romansh","code":"rm"},
{"lang":"Russian","code":"ru"},
{"lang":"Rusyn","code":"rue"},
{"lang":"Sakizaya","code":"szy"},
{"lang":"Samoan","code":"sm"},
{"lang":"Samogitian","code":"bat-smg"},
{"lang":"Sango","code":"sg"},
{"lang":"Sanskrit","code":"sa"},
{"lang":"Santali","code":"sat"},
{"lang":"Saraiki","code":"skr"},
{"lang":"Sardinian","code":"sc"},
{"lang":"SaterlandFrisian","code":"stq"},
{"lang":"Scots","code":"sco"},
{"lang":"ScottishGaelic","code":"gd"},
{"lang":"Seediq","code":"trv"},
{"lang":"Serbian","code":"sr"},
{"lang":"Serbo-Croatian","code":"sh"},
{"lang":"Shan","code":"shn"},
{"lang":"Shilha","code":"shi"},
{"lang":"Shona","code":"sn"},
{"lang":"Sicilian","code":"scn"},
{"lang":"Silesian","code":"szl"},
{"lang":"SimpleEnglish","code":"simple"},
{"lang":"Sindhi","code":"sd"},
{"lang":"Sinhala","code":"si"},
{"lang":"Slovak","code":"sk"},
{"lang":"Slovene","code":"sl"},
{"lang":"Somali","code":"so"},
{"lang":"Sotho","code":"st"},
{"lang":"SouthAzerbaijani","code":"azb"},
{"lang":"SouthernAltai","code":"alt"},
{"lang":"SouthernMin","code":"zh-min-nan"},
{"lang":"SouthernNdebele","code":"nr"},
{"lang":"Spanish","code":"es"},
{"lang":"SrananTongo","code":"srn"},
{"lang":"StandardMoroccanAmazigh","code":"zgh"},
{"lang":"Sundanese","code":"su"},
{"lang":"Swahili","code":"sw"},
{"lang":"Swazi","code":"ss"},
{"lang":"Swedish","code":"sv"},
{"lang":"Tagalog","code":"tl"},
{"lang":"Tahitian","code":"ty"},
{"lang":"TaiNüa","code":"tdd"},
{"lang":"Tajik","code":"tg"},
{"lang":"Talysh","code":"tly"},
{"lang":"Tamil","code":"ta"},
{"lang":"Tarantino","code":"roa-tara"},
{"lang":"Tatar","code":"tt"},
{"lang":"Telugu","code":"te"},
{"lang":"Tetum","code":"tet"},
{"lang":"Thai","code":"th"},
{"lang":"Tigrinya","code":"ti"},
{"lang":"TobaBatak","code":"bbc"},
{"lang":"TokPisin","code":"tpi"},
{"lang":"Tongan","code":"to"},
{"lang":"Tsonga","code":"ts"},
{"lang":"Tswana","code":"tn"},
{"lang":"Tulu","code":"tcy"},
{"lang":"Tumbuka","code":"tum"},
{"lang":"Turkish","code":"tr"},
{"lang":"Turkmen","code":"tk"},
{"lang":"Tuvan","code":"tyv"},
{"lang":"Twi","code":"tw"},
{"lang":"Tyap","code":"kcg"},
{"lang":"Udmurt","code":"udm"},
{"lang":"Ukrainian","code":"uk"},
{"lang":"UpperSorbian","code":"hsb"},
{"lang":"Urdu","code":"ur"},
{"lang":"Uyghur","code":"ug"},
{"lang":"Uzbek","code":"uz"},
{"lang":"Venda","code":"ve"},
{"lang":"Venetian","code":"vec"},
{"lang":"Veps","code":"vep"},
{"lang":"Vietnamese","code":"vi"},
{"lang":"Volapük","code":"vo"},
{"lang":"Võro","code":"fiu-vro"},
{"lang":"Walloon","code":"wa"},
{"lang":"Waray","code":"war"},
{"lang":"Wayuu","code":"guc"},
{"lang":"Welsh","code":"cy"},
{"lang":"WestCoastBajau","code":"bdr"},
{"lang":"WestFlemish","code":"vls"},
{"lang":"WestFrisian","code":"fy"},
{"lang":"WesternArmenian","code":"hyw"},
{"lang":"WesternPunjabi","code":"pnb"},
{"lang":"Wolof","code":"wo"},
{"lang":"WuChinese","code":"wuu"},
{"lang":"Xhosa","code":"xh"},
{"lang":"Yakut","code":"sah"},
{"lang":"Yiddish","code":"yi"},
{"lang":"Yoruba","code":"yo"},
{"lang":"ZamboangaChavacano","code":"cbk-zam"},
{"lang":"Zaza","code":"diq"},
{"lang":"Zeelandic","code":"zea"},
{"lang":"Zhuang(StandardZhuang)","code":"za"},
{"lang":"Zulu","code":"zu"}
];

</script>



</div><!-- End div.main -->
</body>
</html>